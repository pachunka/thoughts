<div style="float:left">
	ACF98A03-C0AD-4498-98B9-871F88BE477B
</div>
<div style="float:right">
	<input type=button value="Personal Profile" onclick="
		ethereum
			.request({ method: 'eth_requestAccounts' })
			.then(goHome)
	">
	<input type=button value="+Post" onclick="
		ethereum
			.request({ method: 'eth_requestAccounts' })
			.then(offerPostAs)
	">
</div>
<hr style="clear:both">

<script>
function goHome (addr) {
	let addr1 = typeof addr == 'string' ? addr : addr[0];
	location.href = `/${ addr1.substr(2).toLowerCase() }/`;
}
function offerPostAs (addr) {
	var marker = document.querySelector('hr');
	while (marker.nextSibling) {
		marker.nextSibling.remove();
	}
	marker.insertAdjacentHTML('afterEnd',`
		<textarea autofocus></textarea>
		<br>
		<input addr="${ attrOK(addr) }" type="button" value="Post as ${ attrOK(addr) }" onclick="postAs(this.getAttribute('addr'))">
	`);
}
function postAs(addr) {
	var txt = document.querySelector('textarea').value;
	//
	//
	web3.eth.personal.sign(web3.utils.fromUtf8(txt),addr,function (err,ans) {
		if (err) throw new Error(err);
		var xh = new XMLHttpRequest;
		xh.open('put','/post/'+addr+'/'+ans);
		//
		xh.onabort = xh.onload = xh.onerror = ev => {
			//console.info("EVL:",ev.type,xh.status,xh.statusText,ev);
			switch (ev.type) {
				case 'load':
					goHome(addr);
					break;
				case 'error':
					alert("Your thought was not posted.");
					break;
			}
		}
		//
		xh.send(txt);
	});
}
</script>
